# 経費精算システム - 完全機能一覧

## 📋 目次
- [認証・アカウント管理](#認証アカウント管理)
- [ダッシュボード](#ダッシュボード)
- [経費管理](#経費管理)
- [承認フロー](#承認フロー)
- [限度額管理](#限度額管理)
- [レポート・分析](#レポート分析)
- [通知機能](#通知機能)
- [管理機能](#管理機能)
- [セキュリティ](#セキュリティ)

---

## 🔐 認証・アカウント管理

### ログイン・認証
- ✅ メールアドレス + パスワード認証
- ✅ パスワードポリシー（8文字以上、英数字記号含む）
- ✅ セッション管理（24時間自動ログアウト）
- ✅ ログアウト機能
- ✅ パスワード変更機能

### アカウント種別
- **MASTER（親アカウント）**
  - 経費申請・承認の両方が可能
  - 子アカウント管理
  - システム管理機能へのアクセス
  - 全経費の閲覧・承認権限

- **CHILD（子アカウント）**
  - 経費申請のみ可能
  - 自分の経費のみ閲覧可能
  - レポート機能は閲覧不可

### ユーザー管理（MASTER権限）
- ✅ 子アカウントの作成
- ✅ ユーザー一覧表示
- ✅ ユーザー情報編集
- ✅ アカウント有効化/無効化
- ✅ 権限設定（他ユーザー閲覧権限）

---

## 📊 ダッシュボード

### 統計カード
- ✅ 月間合計経費
- ✅ 承認待ち件数
- ✅ 今月の申請件数
- ✅ 前月比表示

### グラフ表示
- ✅ 月別経費推移グラフ
- ✅ カテゴリ別内訳
- ✅ インタラクティブなグラフ（Recharts使用）

### 限度額表示
- ✅ 月次限度額の使用状況
- ✅ プログレスバー表示
- ✅ 上限超過警告
- ✅ 上限解放申請ボタン

### 承認待ち一覧（MASTER権限）
- ✅ 承認待ち経費の一覧表示
- ✅ クイック承認・却下機能
- ✅ 経費詳細表示

### タブ機能
- ✅ 概要タブ - 統計とグラフ
- ✅ 経費一覧タブ - 経費管理機能統合
- ✅ レポートタブ - 年次サマリーレポート（MASTER専用）

---

## 💰 経費管理

### 経費申請
- ✅ 経費情報の入力
  - 経費日
  - 金額
  - 税率選択（10%、8%軽減税率、非課税）
  - 税込/税抜自動計算
  - 支払先
  - 目的
  - カテゴリ選択
- ✅ 画像アップロード
  - JPG、PNG、PDF対応
  - 最大10MB
  - 複数枚アップロード可能
- ✅ 下書き保存機能
- ✅ 申請送信

### 経費一覧
- ✅ 経費一覧表示
- ✅ ステータス別フィルター
  - すべて
  - 下書き
  - 申請中
  - 承認済み
  - 却下
- ✅ 経費詳細表示
- ✅ 却下理由の表示
- ✅ 個別PDFエクスポート
- ✅ リアルタイム更新

### 経費編集・削除
- ✅ 経費編集（承認前のみ）
- ✅ 経費削除（承認前のみ）
- ✅ 確認ダイアログ表示

### ステータス管理
- **DRAFT** - 下書き
- **PENDING** - 申請中（承認待ち）
- **APPROVED** - 承認済み
- **REJECTED** - 却下
- **REVISION** - 修正依頼

---

## ✅ 承認フロー

### 経費承認（MASTER権限）
- ✅ 承認待ち経費一覧
- ✅ 経費詳細確認
- ✅ 画像確認
- ✅ ワンクリック承認
- ✅ 却下機能
  - 却下理由の入力（必須）
  - 申請者への通知
- ✅ バルク操作（複数選択）

### 直接編集機能
- ✅ MASTER権限による経費の直接編集
- ✅ 編集履歴の記録（監査ログ）

---

## 💳 限度額管理

### 限度額設定（MASTER権限）
- ✅ ユーザー別・月別限度額設定
- ✅ 限度額の作成・編集・削除
- ✅ 一覧表示（ソート・フィルター対応）

### 限度額使用状況
- ✅ リアルタイム使用状況表示
- ✅ プログレスバー表示
- ✅ 残額表示
- ✅ 上限超過警告

### 上限解放申請
- ✅ 上限超過時の申請機能
- ✅ 申請理由の入力
- ✅ 申請状況の確認
- ✅ 承認・却下機能（MASTER権限）
- ✅ メール通知

---

## 📈 レポート・分析

### 月次レポート
- ✅ 月別経費集計
- ✅ カテゴリ別内訳
- ✅ 前月比較
- ✅ グラフ表示

### カテゴリ別レポート
- ✅ カテゴリ別集計
- ✅ 割合表示
- ✅ 期間指定

### 年次サマリーレポート（MASTER権限）
- ✅ 年度選択機能
- ✅ サマリーカード表示
  - 年間合計
  - 申請件数
  - 平均金額
  - 最高額
- ✅ 最高額・最低額の経費詳細
- ✅ 月別集計
  - 月別グラフ
  - 金額/件数表示
- ✅ カテゴリ別集計
  - カテゴリ別グラフ
  - パーセンテージ表示
- ✅ ユーザー別集計
  - ユーザー別グラフ
  - 平均金額表示
- ✅ PDFエクスポート機能
- ✅ リフレッシュ機能

### エクスポート機能
- ✅ CSVエクスポート
  - 月次レポート
  - カテゴリ別レポート
  - 監査ログ
- ✅ PDFエクスポート
  - 個別経費明細
  - 年次サマリーレポート
  - 日本語フォント対応

---

## 📧 通知機能

### メール通知
- ✅ Nodemailer + SMTP対応
- ✅ HTMLメールテンプレート
- ✅ テキストメール（フォールバック）

### 通知種別
1. **経費申請時（MASTER宛）**
   - 申請者名
   - 金額
   - カテゴリ
   - 支払先
   - 目的
   - 承認画面へのリンク

2. **経費承認時（申請者宛）**
   - 金額
   - カテゴリ
   - 承認日
   - ダッシュボードへのリンク

3. **経費却下時（申請者宛）**
   - 金額
   - カテゴリ
   - 却下理由
   - ダッシュボードへのリンク

4. **上限解放申請時（MASTER宛）**
   - 申請者名
   - 対象年月
   - 現在の使用額
   - 限度額
   - 理由
   - 承認画面へのリンク

5. **上限解放承認時（申請者宛）**
   - 対象年月
   - 承認日
   - ダッシュボードへのリンク

6. **上限解放却下時（申請者宛）**
   - 対象年月
   - 却下理由
   - ダッシュボードへのリンク

### メール設定
- ✅ 開発モード（ログのみ、実送信スキップ）
- ✅ SMTP設定検証
- ✅ エラーハンドリング（メール失敗でも本処理は継続）

---

## 🛠️ 管理機能

### 管理画面（MASTER権限専用）
- ✅ サイドバーナビゲーション
- ✅ モバイル対応（ハンバーガーメニュー）

### 管理タブ
1. **ユーザー管理**
   - ユーザー一覧
   - ユーザー作成・編集
   - 権限設定

2. **限度額管理**
   - 限度額一覧
   - 限度額設定・編集・削除

3. **カテゴリ管理**
   - カテゴリ一覧
   - カテゴリ作成・編集・削除

4. **上限解放申請**
   - 申請一覧
   - 承認・却下機能

5. **経費承認**
   - 承認待ち一覧
   - バルク承認・却下

6. **子アカウント管理**
   - 子アカウント一覧
   - アカウント作成

7. **監査ログ**
   - 全操作ログの閲覧
   - フィルター・検索機能
   - CSVエクスポート

8. **レポート**
   - 年次サマリーレポート
   - PDFエクスポート

9. **システム設定**
   - システム全体の設定

---

## 🔒 セキュリティ

### 認証・認可
- ✅ NextAuth.js v5による強固な認証
- ✅ セッション管理（24時間自動ログアウト）
- ✅ ロールベースのアクセス制御（MASTER/CHILD）
- ✅ API保護（すべてのAPIで認証チェック）
- ✅ CSRF対策
- ✅ XSS対策

### パスワードセキュリティ
- ✅ パスワードハッシュ化（bcrypt）
- ✅ パスワードポリシー
  - 8文字以上
  - 英数字記号含む
- ✅ パスワード変更機能

### 監査ログ
- ✅ 全操作の自動記録
- ✅ 記録内容：
  - ユーザーID
  - アクション（CREATE/UPDATE/DELETE/APPROVE/REJECT）
  - 対象テーブル
  - レコードID
  - 変更前の値（JSON）
  - 変更後の値（JSON）
  - IPアドレス
  - UserAgent
  - タイムスタンプ
- ✅ 監査ログの閲覧・検索（MASTER権限）
- ✅ CSVエクスポート

### データ保護
- ✅ データベース暗号化
- ✅ ファイルアップロード検証
  - ファイル形式チェック
  - ファイルサイズ制限
  - MIMEタイプ検証
- ✅ SQL injection対策（Prisma ORM使用）
- ✅ 環境変数管理（.env）

### アクセス制御
- ✅ ユーザーは自分の経費のみ閲覧・編集可能
- ✅ MASTERは全経費の閲覧・承認が可能
- ✅ APIレベルでの権限チェック
- ✅ 不正アクセス時のエラーレスポンス

---

## 📱 UI/UX

### レスポンシブデザイン
- ✅ PC対応
- ✅ タブレット対応
- ✅ スマートフォン対応
- ✅ ダークモード対応（Tailwind CSS）

### コンポーネント
- ✅ shadcn/ui使用
- ✅ アクセシビリティ対応
- ✅ アニメーション効果
- ✅ ローディング表示
- ✅ エラー表示
- ✅ 成功メッセージ表示

### ナビゲーション
- ✅ ヘッダーナビゲーション
- ✅ サイドバー（管理画面）
- ✅ パンくずリスト
- ✅ ホームボタン

---

## 🚀 パフォーマンス

### 最適化
- ✅ Next.js 14 App Router使用
- ✅ Server Components活用
- ✅ 画像最適化
- ✅ コード分割
- ✅ キャッシング

### データベース
- ✅ Prisma ORM
- ✅ インデックス最適化
- ✅ クエリ最適化
- ✅ コネクションプール

---

## 📦 インストール済みパッケージ

### 主要パッケージ
```json
{
  "next": "14.2.18",
  "react": "18.3.1",
  "typescript": "^5",
  "prisma": "^6.1.0",
  "@prisma/client": "^6.1.0",
  "next-auth": "5.0.0-beta.25",
  "bcrypt": "^5.1.1",
  "zod": "^3.24.1",
  "tailwindcss": "^3.4.1",
  "recharts": "^2.15.0",
  "nodemailer": "^6.9.16",
  "jspdf": "^2.5.2",
  "jspdf-autotable": "^3.8.4"
}
```

---

## ✅ 実装完了度

### 全機能実装完了 - 100% 🎉

すべての主要機能が実装され、動作確認済みです：
- ✅ 認証・アカウント管理
- ✅ 経費申請・編集・削除
- ✅ 経費承認フロー
- ✅ 限度額管理
- ✅ 上限解放申請
- ✅ ダッシュボード
- ✅ レポート・分析
- ✅ 年次サマリーレポート
- ✅ PDFエクスポート
- ✅ メール通知
- ✅ 監査ログ
- ✅ 管理画面
- ✅ セキュリティ機能

---

## 📝 使用方法

詳細な使用方法は [README.md](README.md) をご参照ください。

---

最終更新: 2025-11-11
